generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model StaffRole {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  staff       Staff[]
}

model User {
  id                                          Int                 @id @default(autoincrement())
  firstName                                   String
  lastName                                    String
  email                                       String              @unique
  password                                    String
  role                                        Role                @default(member)
  branchId                                    Int?
  createdAt                                   DateTime            @default(now())
  updatedAt                                   DateTime            @updatedAt
  memberId                                    String?             @unique
  middleName                                  String?
  gender                                      String?
  dob                                         DateTime?
  phone                                       String?
  address                                     String?
  city                                        String?
  state                                       String?
  profile_photo                               String?
  joiningDate                                 DateTime?
  expireDate                                  DateTime?
  memberType                                  String?             @default("Member")
  memberStatus                                String?             @default("Active")
  membershipStatus                            String?             @default("Activate")
  planId                                      Int?
  weight                                      Float?
  height                                      Float?
  chest                                       Float?
  waist                                       Float?
  thigh                                       Float?
  arms                                        Float?
  fat                                         Float?
  username                                    String?
  loginEnabled                                Boolean             @default(false)
  createdBy                                   String?
  managedByStaffId                            Int?
  groupId                                     Int?
  adminBranches                               Branch[]            @relation("BranchAdmin")
  createdBranches                             Branch[]            @relation("BranchCreator")
  createdBranchPlans                          BranchPlan[]        @relation("BranchPlanCreatedBy")
  branchPlanBookings                          BranchPlanBooking[]
  adminClasses                                ClassSchedule[]     @relation("ClassAdmin")
  trainerClasses                              ClassSchedule[]     @relation("ClassTrainer")
  DutyShift_DutyShift_assignedToIdToUser      DutyShift[]         @relation("DutyShift_assignedToIdToUser")
  DutyShift_DutyShift_createdByIdToUser       DutyShift[]         @relation("DutyShift_createdByIdToUser")
  FileUpload                                  FileUpload[]
  Invoice_Invoice_createdByIdToUser           Invoice[]           @relation("Invoice_createdByIdToUser")
  Invoice_Invoice_userIdToUser                Invoice[]           @relation("Invoice_userIdToUser")
  memberBranchPlans                           MemberBranchPlan[]
  memberPlans                                 MemberPlan[]
  Notification_Notification_sentByIdToUser    Notification[]      @relation("Notification_sentByIdToUser")
  Notification_Notification_userIdToUser      Notification[]      @relation("Notification_userIdToUser")
  Payment_Payment_receivedByIdToUser          Payment[]           @relation("Payment_receivedByIdToUser")
  Payment_Payment_userIdToUser                Payment[]           @relation("Payment_userIdToUser")
  createdPlans                                Plan[]              @relation("PlanAdmin")
  bookings                                    PlanBooking[]
  scannedQRs                                  QRCheck[]           @relation("QRCheckMember")
  scannedQRsAsScanner                         QRCheck[]           @relation("QRCheckScanner")
  SalaryRecord_SalaryRecord_createdByIdToUser SalaryRecord[]      @relation("SalaryRecord_createdByIdToUser")
  SalaryRecord_SalaryRecord_staffIdToUser     SalaryRecord[]      @relation("SalaryRecord_staffIdToUser")
  createdStaff                                Staff[]             @relation("StaffCreator")
  managedStaff                                Staff?              @relation("StaffManager")
  Task_Task_assignedToIdToUser                Task[]              @relation("Task_assignedToIdToUser")
  Task_Task_createdByIdToUser                 Task[]              @relation("Task_createdByIdToUser")
  branch                                      Branch?             @relation(fields: [branchId], references: [id], map: "User_branchId_fkey")
  group                                       Group?              @relation("GroupMembers", fields: [groupId], references: [id])
  managedByStaff                              User?               @relation("StaffMembers", fields: [managedByStaffId], references: [id])
  managedMembers                              User[]              @relation("StaffMembers")
  plan                                        Plan?               @relation("MemberPlan", fields: [planId], references: [id])

  @@index([branchId], map: "User_branchId_fkey")
  @@index([groupId], map: "User_groupId_fkey")
  @@index([managedByStaffId], map: "User_managedByStaffId_fkey")
  @@index([planId], map: "User_planId_fkey")
}

model Branch {
  id           Int             @id @default(autoincrement())
  name         String
  code         String          @unique
  address      String
  phone        String?
  email        String?
  status       BranchStatus    @default(INACTIVE)
  hours        Json
  branch_image String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  adminId      Int
  createdById  Int?
  attendances  Attendance[]
  admin        User            @relation("BranchAdmin", fields: [adminId], references: [id])
  createdBy    User?           @relation("BranchCreator", fields: [createdById], references: [id])
  branchPlans  BranchPlan[]
  classes      ClassSchedule[]
  DutyShift    DutyShift[]
  groups       Group[]
  Invoice      Invoice[]
  Notification Notification[]
  Payment      Payment[]
  plans        Plan[]
  qrChecks     QRCheck[]
  SalaryRecord SalaryRecord[]
  staff        Staff[]
  Task         Task[]
  users        User[]

  @@index([adminId], map: "Branch_adminId_fkey")
  @@index([createdById], map: "Branch_createdById_fkey")
}

model Staff {
  id                      Int          @id @default(autoincrement())
  userId                  Int          @unique
  branchId                Int
  roleId                  Int
  staff_id                String       @unique
  gender                  String?
  dob                     DateTime?
  phone                   String?
  profile_photo           String?
  status                  String       @default("Active")
  join_date               DateTime
  exit_date               DateTime?
  salary_type             String?
  hourly_rate             Float?
  fixed_salary            Float?
  commission_rate_percent Float        @default(0)
  login_enabled           Boolean      @default(false)
  username                String?
  password                String?
  createdById             Int?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt
  attendances             Attendance[] @relation("AttendanceStaff")
  qrChecks                QRCheck[]    @relation("QRCheckStaff")
  branch                  Branch       @relation(fields: [branchId], references: [id], map: "Staff_branchId_fkey")
  createdBy               User?        @relation("StaffCreator", fields: [createdById], references: [id], map: "Staff_createdById_fkey")
  role                    StaffRole    @relation(fields: [roleId], references: [id], map: "Staff_roleId_fkey")
  user                    User         @relation("StaffManager", fields: [userId], references: [id], map: "Staff_userId_fkey")

  @@index([branchId], map: "Staff_branchId_fkey")
  @@index([createdById], map: "Staff_createdById_fkey")
  @@index([roleId], map: "Staff_roleId_fkey")
}

model Plan {
  id          Int           @id @default(autoincrement())
  name        String
  type        String
  sessions    Int
  validity    Int
  priceCents  Int
  currency    String        @default("INR")
  active      Boolean       @default(true)
  adminId     Int
  branchId    Int?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  memberPlans MemberPlan[]
  admin       User          @relation("PlanAdmin", fields: [adminId], references: [id], map: "Plan_adminId_fkey")
  branch      Branch?       @relation(fields: [branchId], references: [id], map: "Plan_branchId_fkey")
  bookings    PlanBooking[]
  members     User[]        @relation("MemberPlan")

  @@index([adminId], map: "Plan_adminId_fkey")
  @@index([branchId], map: "Plan_branchId_fkey")
}

model BranchPlan {
  id          Int                 @id @default(autoincrement())
  name        String
  type        String
  sessions    Int
  validity    Int
  priceCents  Int
  currency    String              @default("INR")
  active      Boolean             @default(true)
  branchId    Int
  createdById Int
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  branch      Branch              @relation(fields: [branchId], references: [id], map: "BranchPlan_branchId_fkey")
  createdBy   User                @relation("BranchPlanCreatedBy", fields: [createdById], references: [id], map: "BranchPlan_createdById_fkey")
  bookings    BranchPlanBooking[]
  memberPlans MemberBranchPlan[]

  @@index([branchId], map: "BranchPlan_branchId_fkey")
  @@index([createdById], map: "BranchPlan_createdById_fkey")
}

model PlanBooking {
  id           Int      @id @default(autoincrement())
  memberId     Int
  planId       Int
  requestedAt  DateTime @default(now())
  status       String   @default("pending")
  sessionsUsed Int      @default(0)
  note         String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  member       User     @relation(fields: [memberId], references: [id])
  plan         Plan     @relation(fields: [planId], references: [id])

  @@index([memberId], map: "PlanBooking_memberId_fkey")
  @@index([planId], map: "PlanBooking_planId_fkey")
}

model MemberPlan {
  id                Int      @id @default(autoincrement())
  memberId          Int
  planId            Int
  startDate         DateTime
  expiryDate        DateTime
  remainingSessions Int
  createdAt         DateTime @default(now())
  member            User     @relation(fields: [memberId], references: [id])
  plan              Plan     @relation(fields: [planId], references: [id])

  @@index([memberId], map: "MemberPlan_memberId_fkey")
  @@index([planId], map: "MemberPlan_planId_fkey")
}

model BranchPlanBooking {
  id           Int        @id @default(autoincrement())
  memberId     Int
  branchPlanId Int
  requestedAt  DateTime   @default(now())
  status       String     @default("pending")
  sessionsUsed Int        @default(0)
  note         String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  branchPlan   BranchPlan @relation(fields: [branchPlanId], references: [id])
  member       User       @relation(fields: [memberId], references: [id])

  @@index([branchPlanId], map: "BranchPlanBooking_branchPlanId_fkey")
  @@index([memberId], map: "BranchPlanBooking_memberId_fkey")
}

model MemberBranchPlan {
  id                Int        @id @default(autoincrement())
  memberId          Int
  branchPlanId      Int
  startDate         DateTime
  expiryDate        DateTime
  remainingSessions Int
  createdAt         DateTime   @default(now())
  branchPlan        BranchPlan @relation(fields: [branchPlanId], references: [id])
  member            User       @relation(fields: [memberId], references: [id])

  @@index([branchPlanId], map: "MemberBranchPlan_branchPlanId_fkey")
  @@index([memberId], map: "MemberBranchPlan_memberId_fkey")
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  actorId   Int?
  action    String
  payload   Json?
  branchId  Int?
  createdAt DateTime @default(now())
}

model QRCheck {
  id        Int       @id @default(autoincrement())
  memberId  Int?
  staffId   Int?
  branchId  Int
  nonce     String    @unique
  issuedAt  DateTime
  expiresAt DateTime
  scannedAt DateTime?
  action    String
  status    String    @default("valid")
  scannedBy Int?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  branch    Branch    @relation(fields: [branchId], references: [id], map: "QRCheck_branchId_fkey")
  member    User?     @relation("QRCheckMember", fields: [memberId], references: [id], map: "QRCheck_memberId_fkey")
  scanner   User?     @relation("QRCheckScanner", fields: [scannedBy], references: [id], map: "QRCheck_scannedBy_fkey")
  staff     Staff?    @relation("QRCheckStaff", fields: [staffId], references: [id], map: "QRCheck_staffId_fkey")

  @@index([branchId], map: "QRCheck_branchId_fkey")
  @@index([memberId], map: "QRCheck_memberId_fkey")
  @@index([scannedBy], map: "QRCheck_scannedBy_fkey")
  @@index([staffId], map: "QRCheck_staffId_fkey")
}

model Attendance {
  id           Int       @id @default(autoincrement())
  memberId     Int?
  staffId      Int?
  branchId     Int
  date         DateTime
  checkInTime  DateTime?
  checkOutTime DateTime?
  totalHours   Float?
  status       String    @default("active")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  branch       Branch    @relation(fields: [branchId], references: [id])
  staff        Staff?    @relation("AttendanceStaff", fields: [staffId], references: [id])

  @@index([branchId], map: "Attendance_branchId_fkey")
  @@index([staffId], map: "Attendance_staffId_fkey")
}

model ClassSchedule {
  id           Int      @id @default(autoincrement())
  class_name   String
  trainer_id   Int
  date         DateTime
  time         String
  schedule_day Json
  total_sheets Int      @default(20)
  status       String   @default("Active")
  branchId     Int
  adminId      Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  admin        User     @relation("ClassAdmin", fields: [adminId], references: [id])
  branch       Branch   @relation(fields: [branchId], references: [id])
  trainer      User     @relation("ClassTrainer", fields: [trainer_id], references: [id])

  @@index([adminId], map: "ClassSchedule_adminId_fkey")
  @@index([branchId], map: "ClassSchedule_branchId_fkey")
  @@index([trainer_id], map: "ClassSchedule_trainer_id_fkey")
}

model Group {
  id        Int      @id @default(autoincrement())
  name      String
  photo     String?
  branchId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  branch    Branch   @relation(fields: [branchId], references: [id])
  members   User[]   @relation("GroupMembers")

  @@index([branchId], map: "Group_branchId_fkey")
}

model DutyShift {
  id                                Int      @id @default(autoincrement())
  assignedToId                      Int
  branchId                          Int
  shiftDate                         DateTime
  startTime                         String
  endTime                           String
  shiftType                         String
  status                            String   @default("scheduled")
  notes                             String?
  swapRequested                     Boolean  @default(false)
  swapWithId                        Int?
  createdById                       Int
  createdAt                         DateTime @default(now())
  updatedAt                         DateTime
  User_DutyShift_assignedToIdToUser User     @relation("DutyShift_assignedToIdToUser", fields: [assignedToId], references: [id])
  Branch                            Branch   @relation(fields: [branchId], references: [id])
  User_DutyShift_createdByIdToUser  User     @relation("DutyShift_createdByIdToUser", fields: [createdById], references: [id])

  @@index([assignedToId], map: "DutyShift_assignedToId_fkey")
  @@index([branchId], map: "DutyShift_branchId_fkey")
  @@index([createdById], map: "DutyShift_createdById_fkey")
}

model FileUpload {
  id           Int      @id @default(autoincrement())
  fileName     String
  originalName String
  fileType     String
  mimeType     String
  fileSize     Int
  filePath     String
  category     String
  entityType   String?
  entityId     Int?
  uploadedById Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  User         User     @relation(fields: [uploadedById], references: [id])

  @@index([uploadedById], map: "FileUpload_uploadedById_fkey")
}

model Invoice {
  id                             Int       @id @default(autoincrement())
  invoiceNumber                  String    @unique
  userId                         Int
  branchId                       Int
  amount                         Float
  tax                            Float     @default(0)
  totalAmount                    Float
  currency                       String    @default("INR")
  status                         String    @default("unpaid")
  dueDate                        DateTime
  paidDate                       DateTime?
  items                          Json
  notes                          String?
  createdById                    Int
  createdAt                      DateTime  @default(now())
  updatedAt                      DateTime
  Branch                         Branch    @relation(fields: [branchId], references: [id])
  User_Invoice_createdByIdToUser User      @relation("Invoice_createdByIdToUser", fields: [createdById], references: [id])
  User_Invoice_userIdToUser      User      @relation("Invoice_userIdToUser", fields: [userId], references: [id])
  Payment                        Payment[]

  @@index([branchId], map: "Invoice_branchId_fkey")
  @@index([createdById], map: "Invoice_createdById_fkey")
  @@index([userId], map: "Invoice_userId_fkey")
}

model Notification {
  id                               Int       @id @default(autoincrement())
  userId                           Int
  branchId                         Int?
  type                             String
  title                            String
  message                          String
  priority                         String    @default("normal")
  isRead                           Boolean   @default(false)
  readAt                           DateTime?
  metadata                         Json?
  sentById                         Int?
  createdAt                        DateTime  @default(now())
  updatedAt                        DateTime
  Branch                           Branch?   @relation(fields: [branchId], references: [id])
  User_Notification_sentByIdToUser User?     @relation("Notification_sentByIdToUser", fields: [sentById], references: [id])
  User_Notification_userIdToUser   User      @relation("Notification_userIdToUser", fields: [userId], references: [id])

  @@index([branchId], map: "Notification_branchId_fkey")
  @@index([sentById], map: "Notification_sentById_fkey")
  @@index([userId], map: "Notification_userId_fkey")
}

model Payment {
  id                              Int      @id @default(autoincrement())
  userId                          Int
  branchId                        Int
  amount                          Float
  currency                        String   @default("INR")
  paymentMethod                   String
  paymentType                     String
  transactionId                   String?
  status                          String   @default("pending")
  description                     String?
  invoiceId                       Int?
  receivedById                    Int?
  paymentDate                     DateTime @default(now())
  createdAt                       DateTime @default(now())
  updatedAt                       DateTime
  Branch                          Branch   @relation(fields: [branchId], references: [id])
  Invoice                         Invoice? @relation(fields: [invoiceId], references: [id])
  User_Payment_receivedByIdToUser User?    @relation("Payment_receivedByIdToUser", fields: [receivedById], references: [id])
  User_Payment_userIdToUser       User     @relation("Payment_userIdToUser", fields: [userId], references: [id])

  @@index([branchId], map: "Payment_branchId_fkey")
  @@index([invoiceId], map: "Payment_invoiceId_fkey")
  @@index([receivedById], map: "Payment_receivedById_fkey")
  @@index([userId], map: "Payment_userId_fkey")
}

model SalaryRecord {
  id                                  Int       @id @default(autoincrement())
  staffId                             Int
  branchId                            Int
  month                               Int
  year                                Int
  basicSalary                         Float
  hoursWorked                         Float?
  hourlyRate                          Float?
  commission                          Float     @default(0)
  deductions                          Float     @default(0)
  bonuses                             Float     @default(0)
  netSalary                           Float
  paymentStatus                       String    @default("pending")
  paymentDate                         DateTime?
  paymentMethod                       String?
  notes                               String?
  createdById                         Int
  createdAt                           DateTime  @default(now())
  updatedAt                           DateTime
  Branch                              Branch    @relation(fields: [branchId], references: [id])
  User_SalaryRecord_createdByIdToUser User      @relation("SalaryRecord_createdByIdToUser", fields: [createdById], references: [id])
  User_SalaryRecord_staffIdToUser     User      @relation("SalaryRecord_staffIdToUser", fields: [staffId], references: [id])

  @@index([branchId], map: "SalaryRecord_branchId_fkey")
  @@index([createdById], map: "SalaryRecord_createdById_fkey")
  @@index([staffId], map: "SalaryRecord_staffId_fkey")
}

model Task {
  id                           Int       @id @default(autoincrement())
  title                        String
  description                  String?
  category                     String
  priority                     String    @default("normal")
  status                       String    @default("pending")
  assignedToId                 Int?
  branchId                     Int
  dueDate                      DateTime?
  completedAt                  DateTime?
  notes                        String?
  checklist                    Json?
  createdById                  Int
  createdAt                    DateTime  @default(now())
  updatedAt                    DateTime
  User_Task_assignedToIdToUser User?     @relation("Task_assignedToIdToUser", fields: [assignedToId], references: [id])
  Branch                       Branch    @relation(fields: [branchId], references: [id])
  User_Task_createdByIdToUser  User      @relation("Task_createdByIdToUser", fields: [createdById], references: [id])

  @@index([assignedToId], map: "Task_assignedToId_fkey")
  @@index([branchId], map: "Task_branchId_fkey")
  @@index([createdById], map: "Task_createdById_fkey")
}

enum Role {
  superadmin
  admin
  generaltrainer
  personaltrainer
  member
  housekeeping
  receptionist
}

enum BranchStatus {
  ACTIVE
  INACTIVE
  MAINTENANCE
}
